context("fetchHenry and related")




test_that("month2season() works as expected", {
  
  x <- c('Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May')
  res <- month2season(x)
  
  # classification
  expect_equal(
    as.character(res), 
    c("Summer", "Summer", "Summer", "Fall", "Fall", "Fall", "Winter", "Winter", "Winter", "Spring", "Spring", "Spring")
  )
  
  # factor levels
  expect_equal(
    levels(res),
    c("Winter", "Spring", "Summer", "Fall")
  )
  
  # bogus input
  expect_true(
    is.na(month2season('da'))
  )
  
})



test_that("summarizeSoilTemperature() works as expected", {
  
  ## this is kind of stupid, consider a new sample dataset
  
  x <- structure(
    list(
      sid = c(469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 469L, 
              469L, 469L, 469L, 469L, 469L), 
      date_time = c("2007-12-05 00:00:00", 
                    "2007-12-06 00:00:00", "2007-12-07 00:00:00", "2007-12-08 00:00:00", 
                    "2007-12-09 00:00:00", "2007-12-10 00:00:00", "2007-12-11 00:00:00", 
                    "2007-12-12 00:00:00", "2007-12-13 00:00:00", "2007-12-14 00:00:00", 
                    "2007-12-15 00:00:00", "2007-12-16 00:00:00", "2007-12-17 00:00:00", 
                    "2007-12-18 00:00:00", "2007-12-19 00:00:00", "2007-12-20 00:00:00", 
                    "2007-12-21 00:00:00", "2007-12-22 00:00:00", "2007-12-23 00:00:00", 
                    "2007-12-24 00:00:00", "2007-12-25 00:00:00", "2007-12-26 00:00:00", 
                    "2007-12-27 00:00:00", "2007-12-28 00:00:00", "2007-12-29 00:00:00", 
                    "2007-12-30 00:00:00", "2007-12-31 00:00:00", "2008-01-01 00:00:00", 
                    "2008-01-02 00:00:00", "2008-01-03 00:00:00", "2008-01-04 00:00:00", 
                    "2008-01-05 00:00:00", "2008-01-06 00:00:00", "2008-01-07 00:00:00", 
                    "2008-01-08 00:00:00", "2008-01-09 00:00:00", "2008-01-10 00:00:00", 
                    "2008-01-11 00:00:00", "2008-01-12 00:00:00", "2008-01-13 00:00:00", 
                    "2008-01-14 00:00:00", "2008-01-15 00:00:00", "2008-01-16 00:00:00", 
                    "2008-01-17 00:00:00", "2008-01-18 00:00:00", "2008-01-19 00:00:00", 
                    "2008-01-20 00:00:00", "2008-01-21 00:00:00", "2008-01-22 00:00:00", 
                    "2008-01-23 00:00:00", "2008-01-24 00:00:00", "2008-01-25 00:00:00", 
                    "2008-01-26 00:00:00", "2008-01-27 00:00:00", "2008-01-28 00:00:00", 
                    "2008-01-29 00:00:00", "2008-01-30 00:00:00", "2008-01-31 00:00:00", 
                    "2008-02-01 00:00:00", "2008-02-02 00:00:00", "2008-02-03 00:00:00", 
                    "2008-02-04 00:00:00", "2008-02-05 00:00:00", "2008-02-06 00:00:00", 
                    "2008-02-07 00:00:00", "2008-02-08 00:00:00", "2008-02-09 00:00:00", 
                    "2008-02-10 00:00:00", "2008-02-11 00:00:00", "2008-02-12 00:00:00", 
                    "2008-02-13 00:00:00", "2008-02-14 00:00:00", "2008-02-15 00:00:00", 
                    "2008-02-16 00:00:00", "2008-02-17 00:00:00", "2008-02-18 00:00:00", 
                    "2008-02-19 00:00:00", "2008-02-20 00:00:00", "2008-02-21 00:00:00", 
                    "2008-02-22 00:00:00", "2008-02-23 00:00:00", "2008-02-24 00:00:00", 
                    "2008-02-25 00:00:00", "2008-02-26 00:00:00", "2008-02-27 00:00:00", 
                    "2008-02-28 00:00:00", "2008-02-29 00:00:00", "2008-03-01 00:00:00", 
                    "2008-03-02 00:00:00", "2008-03-03 00:00:00", "2008-03-04 00:00:00", 
                    "2008-03-05 00:00:00", "2008-03-06 00:00:00", "2008-03-07 00:00:00", 
                    "2008-03-08 00:00:00", "2008-03-09 00:00:00", "2008-03-10 00:00:00", 
                    "2008-03-11 00:00:00", "2008-03-12 00:00:00", "2008-03-13 00:00:00", 
                    "2008-03-14 00:00:00", "2008-03-15 00:00:00", "2008-03-16 00:00:00", 
                    "2008-03-17 00:00:00", "2008-03-18 00:00:00", "2008-03-19 00:00:00", 
                    "2008-03-20 00:00:00", "2008-03-21 00:00:00", "2008-03-22 00:00:00", 
                    "2008-03-23 00:00:00", "2008-03-24 00:00:00", "2008-03-25 00:00:00", 
                    "2008-03-26 00:00:00", "2008-03-27 00:00:00", "2008-03-28 00:00:00", 
                    "2008-03-29 00:00:00", "2008-03-30 00:00:00", "2008-03-31 00:00:00", 
                    "2008-04-01 00:00:00", "2008-04-02 00:00:00", "2008-04-03 00:00:00", 
                    "2008-04-04 00:00:00", "2008-04-05 00:00:00", "2008-04-06 00:00:00", 
                    "2008-04-07 00:00:00", "2008-04-08 00:00:00", "2008-04-09 00:00:00", 
                    "2008-04-10 00:00:00", "2008-04-11 00:00:00", "2008-04-12 00:00:00", 
                    "2008-04-13 00:00:00", "2008-04-14 00:00:00", "2008-04-15 00:00:00", 
                    "2008-04-16 00:00:00", "2008-04-17 00:00:00", "2008-04-18 00:00:00", 
                    "2008-04-19 00:00:00", "2008-04-20 00:00:00", "2008-04-21 00:00:00", 
                    "2008-04-22 00:00:00", "2008-04-23 00:00:00", "2008-04-24 00:00:00", 
                    "2008-04-25 00:00:00", "2008-04-26 00:00:00", "2008-04-27 00:00:00", 
                    "2008-04-28 00:00:00", "2008-04-29 00:00:00", "2008-04-30 00:00:00", 
                    "2008-05-01 00:00:00", "2008-05-02 00:00:00", "2008-05-03 00:00:00", 
                    "2008-05-04 00:00:00", "2008-05-05 00:00:00", "2008-05-06 00:00:00", 
                    "2008-05-07 00:00:00", "2008-05-08 00:00:00", "2008-05-09 00:00:00", 
                    "2008-05-10 00:00:00", "2008-05-11 00:00:00", "2008-05-12 00:00:00", 
                    "2008-05-13 00:00:00", "2008-05-14 00:00:00", "2008-05-15 00:00:00", 
                    "2008-05-16 00:00:00", "2008-05-17 00:00:00", "2008-05-18 00:00:00", 
                    "2008-05-19 00:00:00", "2008-05-20 00:00:00", "2008-05-21 00:00:00", 
                    "2008-05-22 00:00:00", "2008-05-23 00:00:00", "2008-05-24 00:00:00", 
                    "2008-05-25 00:00:00", "2008-05-26 00:00:00", "2008-05-27 00:00:00", 
                    "2008-05-28 00:00:00", "2008-05-29 00:00:00", "2008-05-30 00:00:00", 
                    "2008-05-31 00:00:00", "2008-06-01 00:00:00", "2008-06-02 00:00:00", 
                    "2008-06-03 00:00:00", "2008-06-04 00:00:00", "2008-06-05 00:00:00", 
                    "2008-06-06 00:00:00", "2008-06-07 00:00:00", "2008-06-08 00:00:00", 
                    "2008-06-09 00:00:00", "2008-06-10 00:00:00", "2008-06-11 00:00:00", 
                    "2008-06-12 00:00:00", "2008-06-13 00:00:00", "2008-06-14 00:00:00", 
                    "2008-06-15 00:00:00", "2008-06-16 00:00:00", "2008-06-17 00:00:00", 
                    "2008-06-18 00:00:00", "2008-06-19 00:00:00", "2008-06-20 00:00:00", 
                    "2008-06-21 00:00:00", "2008-06-22 00:00:00", "2008-06-23 00:00:00", 
                    "2008-06-24 00:00:00", "2008-06-25 00:00:00", "2008-06-26 00:00:00", 
                    "2008-06-27 00:00:00", "2008-06-28 00:00:00", "2008-06-29 00:00:00", 
                    "2008-06-30 00:00:00", "2008-07-01 00:00:00", "2008-07-02 00:00:00", 
                    "2008-07-03 00:00:00", "2008-07-04 00:00:00", "2008-07-05 00:00:00", 
                    "2008-07-06 00:00:00", "2008-07-07 00:00:00", "2008-07-08 00:00:00", 
                    "2008-07-09 00:00:00", "2008-07-10 00:00:00", "2008-07-11 00:00:00", 
                    "2008-07-12 00:00:00", "2008-07-13 00:00:00", "2008-07-14 00:00:00", 
                    "2008-07-15 00:00:00", "2008-07-16 00:00:00", "2008-07-17 00:00:00", 
                    "2008-07-18 00:00:00", "2008-07-19 00:00:00", "2008-07-20 00:00:00", 
                    "2008-07-21 00:00:00", "2008-07-22 00:00:00", "2008-07-23 00:00:00", 
                    "2008-07-24 00:00:00", "2008-07-25 00:00:00", "2008-07-26 00:00:00", 
                    "2008-07-27 00:00:00", "2008-07-28 00:00:00", "2008-07-29 00:00:00", 
                    "2008-07-30 00:00:00", "2008-07-31 00:00:00", "2008-08-01 00:00:00", 
                    "2008-08-02 00:00:00", "2008-08-03 00:00:00", "2008-08-04 00:00:00", 
                    "2008-08-05 00:00:00", "2008-08-06 00:00:00", "2008-08-07 00:00:00", 
                    "2008-08-08 00:00:00", "2008-08-09 00:00:00", "2008-08-10 00:00:00", 
                    "2008-08-11 00:00:00", "2008-08-12 00:00:00", "2008-08-13 00:00:00", 
                    "2008-08-14 00:00:00", "2008-08-15 00:00:00", "2008-08-16 00:00:00", 
                    "2008-08-17 00:00:00", "2008-08-18 00:00:00", "2008-08-19 00:00:00", 
                    "2008-08-20 00:00:00", "2008-08-21 00:00:00", "2008-08-22 00:00:00", 
                    "2008-08-23 00:00:00", "2008-08-24 00:00:00", "2008-08-25 00:00:00", 
                    "2008-08-26 00:00:00", "2008-08-27 00:00:00", "2008-08-28 00:00:00", 
                    "2008-08-29 00:00:00", "2008-08-30 00:00:00", "2008-08-31 00:00:00", 
                    "2008-09-01 00:00:00", "2008-09-02 00:00:00", "2008-09-03 00:00:00", 
                    "2008-09-04 00:00:00", "2008-09-05 00:00:00", "2008-09-06 00:00:00", 
                    "2008-09-07 00:00:00", "2008-09-08 00:00:00", "2008-09-09 00:00:00", 
                    "2008-09-10 00:00:00", "2008-09-11 00:00:00", "2008-09-12 00:00:00", 
                    "2008-09-13 00:00:00", "2008-09-14 00:00:00", "2008-09-15 00:00:00", 
                    "2008-09-16 00:00:00", "2008-09-17 00:00:00", "2008-09-18 00:00:00", 
                    "2008-09-19 00:00:00", "2008-09-20 00:00:00", "2008-09-21 00:00:00", 
                    "2008-09-22 00:00:00", "2008-09-23 00:00:00", "2008-09-24 00:00:00", 
                    "2008-09-25 00:00:00", "2008-09-26 00:00:00", "2008-09-27 00:00:00", 
                    "2008-09-28 00:00:00", "2008-09-29 00:00:00", "2008-09-30 00:00:00", 
                    "2008-10-01 00:00:00", "2008-10-02 00:00:00", "2008-10-03 00:00:00", 
                    "2008-10-04 00:00:00", "2008-10-05 00:00:00", "2008-10-06 00:00:00", 
                    "2008-10-07 00:00:00", "2008-10-08 00:00:00", "2008-10-09 00:00:00", 
                    "2008-10-10 00:00:00", "2008-10-11 00:00:00", "2008-10-12 00:00:00", 
                    "2008-10-13 00:00:00", "2008-10-14 00:00:00", "2008-10-15 00:00:00", 
                    "2008-10-16 00:00:00", "2008-10-17 00:00:00", "2008-10-18 00:00:00", 
                    "2008-10-19 00:00:00", "2008-10-20 00:00:00", "2008-10-21 00:00:00", 
                    "2008-10-22 00:00:00", "2008-10-23 00:00:00", "2008-10-24 00:00:00", 
                    "2008-10-25 00:00:00", "2008-10-26 00:00:00", "2008-10-27 00:00:00", 
                    "2008-10-28 00:00:00", "2008-10-29 00:00:00", "2008-10-30 00:00:00", 
                    "2008-10-31 00:00:00", "2008-11-01 00:00:00", "2008-11-02 00:00:00", 
                    "2008-11-03 00:00:00", "2008-11-04 00:00:00", "2008-11-05 00:00:00", 
                    "2008-11-06 00:00:00", "2008-11-07 00:00:00", "2008-11-08 00:00:00", 
                    "2008-11-09 00:00:00", "2008-11-10 00:00:00", "2008-11-11 00:00:00", 
                    "2008-11-12 00:00:00", "2008-11-13 00:00:00", "2008-11-14 00:00:00", 
                    "2008-11-15 00:00:00", "2008-11-16 00:00:00", "2008-11-17 00:00:00", 
                    "2008-11-18 00:00:00", "2008-11-19 00:00:00", "2008-11-20 00:00:00", 
                    "2008-11-21 00:00:00", "2008-11-22 00:00:00", "2008-11-23 00:00:00", 
                    "2008-11-24 00:00:00", "2008-11-25 00:00:00", "2008-11-26 00:00:00", 
                    "2008-11-27 00:00:00", "2008-11-28 00:00:00", "2008-11-29 00:00:00", 
                    "2008-11-30 00:00:00", "2008-12-01 00:00:00", "2008-12-02 00:00:00", 
                    "2008-12-03 00:00:00", "2008-12-04 00:00:00", "2008-12-05 00:00:00", 
                    "2008-12-06 00:00:00", "2008-12-07 00:00:00", "2008-12-08 00:00:00", 
                    "2008-12-09 00:00:00", "2008-12-10 00:00:00", "2008-12-11 00:00:00", 
                    "2008-12-12 00:00:00", "2008-12-13 00:00:00", "2008-12-14 00:00:00", 
                    "2008-12-15 00:00:00", "2008-12-16 00:00:00", "2008-12-17 00:00:00", 
                    "2008-12-18 00:00:00", "2008-12-19 00:00:00", "2008-12-20 00:00:00", 
                    "2008-12-21 00:00:00", "2008-12-22 00:00:00", "2008-12-23 00:00:00", 
                    "2008-12-24 00:00:00", "2008-12-25 00:00:00", "2008-12-26 00:00:00", 
                    "2008-12-27 00:00:00", "2008-12-28 00:00:00", "2008-12-29 00:00:00", 
                    "2008-12-30 00:00:00", "2008-12-31 00:00:00", "2009-01-01 00:00:00", 
                    "2009-01-02 00:00:00", "2009-01-03 00:00:00", "2009-01-04 00:00:00", 
                    "2009-01-05 00:00:00", "2009-01-06 00:00:00", "2009-01-07 00:00:00", 
                    "2009-01-08 00:00:00", "2009-01-09 00:00:00", "2009-01-10 00:00:00", 
                    "2009-01-11 00:00:00", "2009-01-12 00:00:00", "2009-01-13 00:00:00", 
                    "2009-01-14 00:00:00", "2009-01-15 00:00:00", "2009-01-16 00:00:00", 
                    "2009-01-17 00:00:00", "2009-01-18 00:00:00", "2009-01-19 00:00:00", 
                    "2009-01-20 00:00:00", "2009-01-21 00:00:00", "2009-01-22 00:00:00", 
                    "2009-01-23 00:00:00", "2009-01-24 00:00:00", "2009-01-25 00:00:00", 
                    "2009-01-26 00:00:00", "2009-01-27 00:00:00", "2009-01-28 00:00:00", 
                    "2009-01-29 00:00:00", "2009-01-30 00:00:00", "2009-01-31 00:00:00", 
                    "2009-02-01 00:00:00", "2009-02-02 00:00:00", "2009-02-03 00:00:00", 
                    "2009-02-04 00:00:00", "2009-02-05 00:00:00", "2009-02-06 00:00:00", 
                    "2009-02-07 00:00:00", "2009-02-08 00:00:00", "2009-02-09 00:00:00", 
                    "2009-02-10 00:00:00", "2009-02-11 00:00:00", "2009-02-12 00:00:00", 
                    "2009-02-13 00:00:00", "2009-02-14 00:00:00", "2009-02-15 00:00:00", 
                    "2009-02-16 00:00:00", "2009-02-17 00:00:00", "2009-02-18 00:00:00", 
                    "2009-02-19 00:00:00", "2009-02-20 00:00:00", "2009-02-21 00:00:00", 
                    "2009-02-22 00:00:00", "2009-02-23 00:00:00", "2009-02-24 00:00:00", 
                    "2009-02-25 00:00:00", "2009-02-26 00:00:00", "2009-02-27 00:00:00", 
                    "2009-02-28 00:00:00", "2009-03-01 00:00:00", "2009-03-02 00:00:00", 
                    "2009-03-03 00:00:00", "2009-03-04 00:00:00", "2009-03-05 00:00:00", 
                    "2009-03-06 00:00:00", "2009-03-07 00:00:00", "2009-03-08 00:00:00", 
                    "2009-03-09 00:00:00", "2009-03-10 00:00:00", "2009-03-11 00:00:00", 
                    "2009-03-12 00:00:00", "2009-03-13 00:00:00", "2009-03-14 00:00:00", 
                    "2009-03-15 00:00:00", "2009-03-16 00:00:00", "2009-03-17 00:00:00", 
                    "2009-03-18 00:00:00", "2009-03-19 00:00:00", "2009-03-20 00:00:00", 
                    "2009-03-21 00:00:00", "2009-03-22 00:00:00", "2009-03-23 00:00:00", 
                    "2009-03-24 00:00:00", "2009-03-25 00:00:00", "2009-03-26 00:00:00", 
                    "2009-03-27 00:00:00", "2009-03-28 00:00:00", "2009-03-29 00:00:00", 
                    "2009-03-30 00:00:00", "2009-03-31 00:00:00", "2009-04-01 00:00:00", 
                    "2009-04-02 00:00:00", "2009-04-03 00:00:00", "2009-04-04 00:00:00", 
                    "2009-04-05 00:00:00", "2009-04-06 00:00:00", "2009-04-07 00:00:00", 
                    "2009-04-08 00:00:00", "2009-04-09 00:00:00", "2009-04-10 00:00:00", 
                    "2009-04-11 00:00:00", "2009-04-12 00:00:00", "2009-04-13 00:00:00", 
                    "2009-04-14 00:00:00", "2009-04-15 00:00:00", "2009-04-16 00:00:00", 
                    "2009-04-17 00:00:00", "2009-04-18 00:00:00", "2009-04-19 00:00:00", 
                    "2009-04-20 00:00:00", "2009-04-21 00:00:00", "2009-04-22 00:00:00", 
                    "2009-04-23 00:00:00", "2009-04-24 00:00:00", "2009-04-25 00:00:00", 
                    "2009-04-26 00:00:00", "2009-04-27 00:00:00", "2009-04-28 00:00:00", 
                    "2009-04-29 00:00:00", "2009-04-30 00:00:00", "2009-05-01 00:00:00", 
                    "2009-05-02 00:00:00", "2009-05-03 00:00:00", "2009-05-04 00:00:00", 
                    "2009-05-05 00:00:00", "2009-05-06 00:00:00", "2009-05-07 00:00:00", 
                    "2009-05-08 00:00:00", "2009-05-09 00:00:00", "2009-05-10 00:00:00", 
                    "2009-05-11 00:00:00", "2009-05-12 00:00:00", "2009-05-13 00:00:00", 
                    "2009-05-14 00:00:00", "2009-05-15 00:00:00", "2009-05-16 00:00:00", 
                    "2009-05-17 00:00:00", "2009-05-18 00:00:00", "2009-05-19 00:00:00", 
                    "2009-05-20 00:00:00", "2009-05-21 00:00:00", "2009-05-22 00:00:00", 
                    "2009-05-23 00:00:00", "2009-05-24 00:00:00", "2009-05-25 00:00:00", 
                    "2009-05-26 00:00:00", "2009-05-27 00:00:00", "2009-05-28 00:00:00", 
                    "2009-05-29 00:00:00", "2009-05-30 00:00:00", "2009-05-31 00:00:00", 
                    "2009-06-01 00:00:00", "2009-06-02 00:00:00", "2009-06-03 00:00:00", 
                    "2009-06-04 00:00:00", "2009-06-05 00:00:00", "2009-06-06 00:00:00", 
                    "2009-06-07 00:00:00", "2009-06-08 00:00:00", "2009-06-09 00:00:00", 
                    "2009-06-10 00:00:00", "2009-06-11 00:00:00", "2009-06-12 00:00:00", 
                    "2009-06-13 00:00:00", "2009-06-14 00:00:00", "2009-06-15 00:00:00", 
                    "2009-06-16 00:00:00", "2009-06-17 00:00:00", "2009-06-18 00:00:00", 
                    "2009-06-19 00:00:00", "2009-06-20 00:00:00", "2009-06-21 00:00:00", 
                    "2009-06-22 00:00:00", "2009-06-23 00:00:00", "2009-06-24 00:00:00", 
                    "2009-06-25 00:00:00", "2009-06-26 00:00:00", "2009-06-27 00:00:00", 
                    "2009-06-28 00:00:00", "2009-06-29 00:00:00", "2009-06-30 00:00:00", 
                    "2009-07-01 00:00:00", "2009-07-02 00:00:00", "2009-07-03 00:00:00", 
                    "2009-07-04 00:00:00", "2009-07-05 00:00:00", "2009-07-06 00:00:00", 
                    "2009-07-07 00:00:00", "2009-07-08 00:00:00", "2009-07-09 00:00:00", 
                    "2009-07-10 00:00:00", "2009-07-11 00:00:00", "2009-07-12 00:00:00", 
                    "2009-07-13 00:00:00", "2009-07-14 00:00:00", "2009-07-15 00:00:00", 
                    "2009-07-16 00:00:00", "2009-07-17 00:00:00", "2009-07-18 00:00:00", 
                    "2009-07-19 00:00:00", "2009-07-20 00:00:00", "2009-07-21 00:00:00", 
                    "2009-07-22 00:00:00", "2009-07-23 00:00:00", "2009-07-24 00:00:00", 
                    "2009-07-25 00:00:00", "2009-07-26 00:00:00", "2009-07-27 00:00:00", 
                    "2009-07-28 00:00:00", "2009-07-29 00:00:00", "2009-07-30 00:00:00", 
                    "2009-07-31 00:00:00", "2009-08-01 00:00:00", "2009-08-02 00:00:00", 
                    "2009-08-03 00:00:00", "2009-08-04 00:00:00", "2009-08-05 00:00:00", 
                    "2009-08-06 00:00:00", "2009-08-07 00:00:00", "2009-08-08 00:00:00", 
                    "2009-08-09 00:00:00", "2009-08-10 00:00:00", "2009-08-11 00:00:00", 
                    "2009-08-12 00:00:00", "2009-08-13 00:00:00", "2009-08-14 00:00:00", 
                    "2009-08-15 00:00:00", "2009-08-16 00:00:00", "2009-08-17 00:00:00", 
                    "2009-08-18 00:00:00", "2009-08-19 00:00:00", "2009-08-20 00:00:00", 
                    "2009-08-21 00:00:00", "2009-08-22 00:00:00", "2009-08-23 00:00:00", 
                    "2009-08-24 00:00:00", "2009-08-25 00:00:00", "2009-08-26 00:00:00", 
                    "2009-08-27 00:00:00", "2009-08-28 00:00:00", "2009-08-29 00:00:00", 
                    "2009-08-30 00:00:00", "2009-08-31 00:00:00", "2009-09-01 00:00:00", 
                    "2009-09-02 00:00:00", "2009-09-03 00:00:00", "2009-09-04 00:00:00", 
                    "2009-09-05 00:00:00", "2009-09-06 00:00:00", "2009-09-07 00:00:00", 
                    "2009-09-08 00:00:00", "2009-09-09 00:00:00", "2009-09-10 00:00:00", 
                    "2009-09-11 00:00:00", "2009-09-12 00:00:00", "2009-09-13 00:00:00", 
                    "2009-09-14 00:00:00", "2009-09-15 00:00:00", "2009-09-16 00:00:00", 
                    "2009-09-17 00:00:00", "2009-09-18 00:00:00", "2009-09-19 00:00:00", 
                    "2009-09-20 00:00:00", "2009-09-21 00:00:00", "2009-09-22 00:00:00", 
                    "2009-09-23 00:00:00", "2009-09-24 00:00:00", "2009-09-25 00:00:00", 
                    "2009-09-26 00:00:00", "2009-09-27 00:00:00", "2009-09-28 00:00:00", 
                    "2009-09-29 00:00:00", "2009-09-30 00:00:00", "2009-10-01 00:00:00", 
                    "2009-10-02 00:00:00", "2009-10-03 00:00:00", "2009-10-04 00:00:00", 
                    "2009-10-05 00:00:00", "2009-10-06 00:00:00", "2009-10-07 00:00:00", 
                    "2009-10-08 00:00:00", "2009-10-09 00:00:00", "2009-10-10 00:00:00", 
                    "2009-10-11 00:00:00", "2009-10-12 00:00:00", "2009-10-13 00:00:00", 
                    "2009-10-14 00:00:00", "2009-10-15 00:00:00", "2009-10-16 00:00:00", 
                    "2009-10-17 00:00:00", "2009-10-18 00:00:00", "2009-10-19 00:00:00", 
                    "2009-10-20 00:00:00", "2009-10-21 00:00:00", "2009-10-22 00:00:00", 
                    "2009-10-23 00:00:00", "2009-10-24 00:00:00", "2009-10-25 00:00:00", 
                    "2009-10-26 00:00:00", "2009-10-27 00:00:00", "2009-10-28 00:00:00", 
                    "2009-10-29 00:00:00", "2009-10-30 00:00:00", "2009-10-31 00:00:00", 
                    "2009-11-01 00:00:00", "2009-11-02 00:00:00", "2009-11-03 00:00:00", 
                    "2009-11-04 00:00:00", "2009-11-05 00:00:00", "2009-11-06 00:00:00", 
                    "2009-11-07 00:00:00", "2009-11-08 00:00:00", "2009-11-09 00:00:00", 
                    "2009-11-10 00:00:00", "2009-11-11 00:00:00", "2009-11-12 00:00:00", 
                    "2009-11-13 00:00:00", "2009-11-14 00:00:00", "2009-11-15 00:00:00", 
                    "2009-11-16 00:00:00", "2009-11-17 00:00:00", "2009-11-18 00:00:00", 
                    "2009-11-19 00:00:00", "2009-11-20 00:00:00", "2009-11-21 00:00:00", 
                    "2009-11-22 00:00:00", "2009-11-23 00:00:00", "2009-11-24 00:00:00", 
                    "2009-11-25 00:00:00", "2009-11-26 00:00:00", "2009-11-27 00:00:00", 
                    "2009-11-28 00:00:00", "2009-11-29 00:00:00", "2009-11-30 00:00:00", 
                    "2009-12-01 00:00:00", "2009-12-02 00:00:00", "2009-12-03 00:00:00", 
                    "2009-12-04 00:00:00", "2009-12-05 00:00:00", "2009-12-06 00:00:00", 
                    "2009-12-07 00:00:00", "2009-12-08 00:00:00", "2009-12-09 00:00:00", 
                    "2009-12-10 00:00:00", "2009-12-11 00:00:00", "2009-12-12 00:00:00", 
                    "2009-12-13 00:00:00", "2009-12-14 00:00:00", "2009-12-15 00:00:00", 
                    "2009-12-16 00:00:00", "2009-12-17 00:00:00", "2009-12-18 00:00:00", 
                    "2009-12-19 00:00:00", "2009-12-20 00:00:00", "2009-12-21 00:00:00", 
                    "2009-12-22 00:00:00"), 
      sensor_value = c(8.23, 8.555, 8.82, 8.953, 
                       8.62, 8.49, 8.23, 7.963, 7.83, 7.63, 7.43, 7.088, 7.02, 7.02, 
                       7.02, 7.02, 7.02, 6.953, 6.687, 6.62, 6.62, 6.552, 6.21, 6.21, 
                       6.01, 5.81, 5.943, 6.21, 6.077, 6.077, 6.21, 6.143, 6.143, 5.81, 
                       5.81, 5.81, 5.81, 5.81, 5.81, 5.81, 5.81, 5.81, 5.81, 5.81, 5.537, 
                       5.4, 5.4, 5.4, 5.19, 4.98, 4.912, 4.57, 4.57, 4.775, 4.98, 4.98, 
                       4.57, 4.57, 4.29, 4.15, 4.01, 3.73, 3.73, 3.59, 3.73, 3.73, 3.73, 
                       4.15, 4.57, 4.707, 4.98, 4.98, 4.98, 4.57, 4.57, 4.912, 4.98, 
                       5.12, 5.4, 5.4, 5.33, 4.98, 4.98, 4.98, 5.33, 5.605, 5.81, 6.143, 
                       6.143, 5.877, 5.81, 5.81, 5.81, 6.077, 6.21, 6.21, 6.21, 6.62, 
                       6.887, 7.02, 7.02, 7.02, 6.753, 6.21, 6.21, 6.21, 6.347, 6.483, 
                       6.483, 6.62, 6.687, 7.02, 7.02, 7.02, 7.02, 7.02, 7.293, 7.225, 
                       7.02, 7.02, 7.362, 7.43, 7.497, 7.697, 7.763, 7.43, 7.43, 7.43, 
                       7.63, 7.897, 8.36, 8.953, 9.02, 8.687, 8.62, 8.82, 9.02, 9.02, 
                       8.555, 8.23, 8.23, 8.23, 8.23, 8.555, 9.02, 9.615, 9.877, 9.877, 
                       9.68, 9.42, 9.81, 9.81, 9.877, 10.21, 10.47, 10.6, 10.6, 10.6, 
                       10.99, 10.99, 10.99, 11.12, 11.38, 11.965, 12.477, 12.93, 13.247, 
                       13.31, 13.31, 13.057, 12.735, 12.477, 12.095, 11.77, 11.51, 11.38, 
                       11.38, 11.38, 11.77, 11.77, 12.16, 12.16, 12.54, 12.413, 12.54, 
                       12.54, 12.54, 12.735, 12.93, 13.31, 13.31, 13.31, 13.763, 14.08, 
                       14.08, 14.46, 14.46, 14.46, 14.85, 15.04, 15.23, 15.357, 15.357, 
                       15.547, 15.61, 15.61, 15.61, 15.935, 16, 16, 16, 16, 16.123, 
                       16, 16, 16.37, 16.63, 17.068, 17.455, 17.583, 17.583, 17.583, 
                       17.647, 17.9, 17.9, 17.9, 17.837, 17.9, 17.9, 17.9, 17.647, 17.52, 
                       17.583, 17.647, 17.837, 17.9, 17.9, 17.9, 17.773, 17.52, 17.647, 
                       17.773, 17.9, 17.9, 17.963, 18.027, 18.28, 18.28, 18.28, 18.217, 
                       17.963, 18.217, 18.28, 18.533, 18.66, 18.977, 19.04, 19.04, 18.787, 
                       18.533, 18.28, 18.28, 18.28, 18.66, 18.66, 18.66, 18.66, 18.66, 
                       18.913, 19.04, 18.977, 18.597, 18.28, 18.09, 18.153, 18.28, 18.28, 
                       18.28, 18.533, 18.407, 18.28, 18.027, 17.9, 17.9, 17.9, 17.9, 
                       17.9, 17.9, 17.9, 17.773, 17.52, 17.195, 17.007, 16.76, 16.76, 
                       16.76, 17.13, 17.13, 17.13, 17.13, 17.195, 17.455, 17.52, 17.325, 
                       17.068, 16.565, 16.123, 15.935, 15.805, 15.61, 15.483, 14.783, 
                       14.207, 13.698, 13.31, 13.31, 13.505, 13.7, 14.08, 14.08, 14.08, 
                       14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 
                       14.08, 14.08, 14.08, 14.08, 13.57, 13.183, 12.735, 12.223, 11.965, 
                       11.77, 11.77, 11.77, 11.38, 11.38, 11.38, 11.38, 11.38, 11.38, 
                       11.575, 11.77, 11.77, 11.705, 11.445, 11.185, 10.99, 10.86, 10.86, 
                       10.86, 10.99, 10.925, 10.6, 10.6, 10.6, 10.6, 10.405, 10.143, 
                       9.81, 9.68, 9.42, 9.42, 9.087, 9.02, 8.753, 8.62, 8.62, 8.49, 
                       8.097, 7.83, 7.43, 7.02, 6.753, 6.62, 6.21, 6.21, 6.21, 6.21, 
                       5.943, 5.81, 5.537, 5.4, 5.4, 5.4, 5.4, 5.4, 5.537, 5.81, 5.742, 
                       5.4, 5.4, 5.468, 5.742, 5.81, 5.81, 5.81, 5.81, 5.81, 6.143, 
                       6.21, 6.21, 6.21, 6.552, 6.62, 6.62, 6.62, 6.887, 7.088, 7.563, 
                       7.763, 7.293, 6.887, 6.415, 6.21, 6.21, 6.21, 6.21, 6.21, 6.21, 
                       6.552, 6.62, 6.82, 6.887, 6.953, 6.82, 6.415, 6.01, 5.81, 5.468, 
                       5.4, 4.98, 4.98, 4.638, 4.57, 4.57, 4.57, 4.912, 5.05, 5.468, 
                       5.877, 6.21, 6.21, 6.483, 6.21, 6.552, 6.82, 7.02, 6.953, 6.552, 
                       6.21, 6.21, 6.01, 5.74, 5.4, 5.33, 5.4, 5.4, 5.537, 5.81, 6.077, 
                       6.21, 6.62, 6.953, 7.293, 7.43, 7.697, 6.82, 6.21, 6.21, 6.62, 
                       7.02, 7.362, 7.83, 7.63, 7.43, 7.497, 7.83, 7.83, 7.697, 7.43, 
                       7.497, 7.897, 7.963, 7.83, 7.83, 7.83, 7.83, 8.163, 8.62, 8.227, 
                       7.83, 7.83, 8.295, 9.02, 9.812, 10.535, 11.185, 11.51, 11.575, 
                       10.86, 10.34, 10.21, 10.143, 9.81, 9.81, 9.943, 10.21, 10.21, 
                       10.405, 10.925, 11.25, 11.445, 11.77, 12.16, 12.223, 12.54, 12.54, 
                       12.54, 12.54, 12.605, 12.993, 13.505, 14.08, 14.46, 14.46, 14.27, 
                       14.397, 14.46, 14.46, 14.27, 14.27, 14.525, 14.913, 15.23, 15.357, 
                       15.61, 15.61, 15.357, 15.04, 14.913, 14.527, 13.89, 13.7, 13.89, 
                       14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 14.08, 14.46, 
                       14.85, 15.23, 15.42, 15.23, 14.977, 15.23, 15.61, 16, 16.123, 
                       16.37, 16.76, 17.13, 17.52, 17.455, 17.52, 17.52, 17.647, 17.647, 
                       17.583, 17.325, 17.068, 16.945, 16.883, 16.945, 17.13, 17.13, 
                       17.39, 17.583, 17.963, 18.28, 18.66, 18.723, 19.04, 19.103, 19.04, 
                       19.04, 19.04, 18.913, 19.04, 19.04, 19.23, 19.293, 19.42, 19.42, 
                       19.357, 19.23, 19.103, 18.977, 18.787, 18.47, 17.71, 17.52, 17.647, 
                       17.963, 18.343, 18.66, 18.787, 18.787, 18.407, 18.217, 18.28, 
                       18.47, 18.723, 19.04, 19.103, 19.357, 19.23, 18.85, 18.787, 18.723, 
                       18.66, 18.913, 19.04, 19.04, 19.103, 19.167, 19.04, 19.357, 19.357, 
                       19.167, 18.787, 18.343, 18.027, 17.9, 18.027, 18.28, 18.66, 18.47, 
                       18.027, 17.325, 17.13, 17.13, 17.52, 17.583, 17.71, 17.583, 17.9, 
                       17.9, 17.9, 17.9, 17.9, 18.09, 18.09, 17.963, 17.01, 16.185, 
                       16, 15.805, 15.42, 14.718, 14.207, 14.08, 14.08, 14.08, 14.08, 
                       14.08, 14.08, 13.953, 13.7, 14.017, 14.08, 14.46, 14.525, 14.655, 
                       14.017, 13.375, 13.057, 13.183, 13.31, 13.31, 13.31, 13.247, 
                       12.543, 11.575, 11.12, 10.99, 11.324, 11.445, 11.835, 12.16, 
                       12.03, 11.64, 11.445, 11.185, 10.925, 10.99, 10.99, 10.99, 10.47, 
                       9.943, 9.615, 9.42, 9.42, 9.42, 9.287, 9.02, 9.02, 8.82, 8.753, 
                       8.62, 8.62, 8.62, 8.62, 8.62, 8.23, 7.83, 7.83, 7.83, 7.563, 
                       7.43, 7.43, 7.02, 6.687, 6.278, 6.143, 5.81, 5.81, 5.943, 6.21, 
                       6.21, 6.21, 6.347, 6.62, 6.62, 6.62, 6.687, 7.02, 7.02)
    ), 
    class = "data.frame", 
    row.names = c(NA, 749L)
  )
  
  s <- soilDB:::.formatDates(x, gran = 'day', pad.missing.days = TRUE)
  
  res <- summarizeSoilTemperature(s)
  
  expect_true(
    nrow(res) == 1
  )
  
  expect_equal(
    res$days.of.data, 749L
  )
  
  expect_equal(
    res$gap.index, 0.32
  )
  
  expect_equal(
    res$functional.yrs, 2
  )
  
  expect_equal(
    res$complete.yrs, 1L
  )
  
  expect_equal(
    res$MAST, 11.65
  )
  
  expect_equal(
    res$Winter, 6.16
  )

  expect_equal(
    res$Summer, 16.92
  )

  expect_equal(
    as.character(res$STR), 'mesic'
  )
      
})


test_that(".fill_missing_days() works as expected", {
  
  x <- data.frame(
    sid = 1,
    date_time = as.POSIXct('2010-02-17 00:00:00'),
    sensor_value = 1,
    year = 2010,
    doy = 48,
    month = 'Feb',
    season = 'Winter',
    water_year = 2010,
    water_day = 140
  )
  
  res <- soilDB:::.fill_missing_days(x)
  
  # there should be 365 records
  expect_true(nrow(res) == 365)
  
  ## TODO more tests
  
  
})


test_that(".formatDates() works as expected", {
  
  x <- data.frame(
    sid = c(1L, 2L),
    date_time = c("2010-02-17 00:00:00", "2021-01-01 00:00:00"),
    sensor_value = c(40.000, 5.5)
  )
  
  res <- soilDB:::.formatDates(x, gran = 'day', pad.missing.days = FALSE)
  
  
  # expected structure
  expect_true(nrow(res) == nrow(x))
  
  expect_equal(res$sid, x$sid)
  
  expect_true(inherits(res$date_time, 'POSIXct'))
  
  expect_equal(res$sensor_value, x$sensor_value)
  
  expect_equal(res$year, c(2010L, 2021L))
  
  expect_equal(res$doy, c(48L, 1L))
  
  expect_equal(as.character(res$month), c('Feb', 'Jan'))
  
  expect_equal(res$water_year, c(2010L, 2021L))
  
  expect_equal(res$water_day, c(140L, 93L))
  
})



test_that("fetchHenry() works as expected", {
  
  expect_true(TRUE)
  
})









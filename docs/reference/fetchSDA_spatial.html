<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Query SDA and Return Spatial Data — fetchSDA_spatial • soilDB</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Query SDA and Return Spatial Data — fetchSDA_spatial" />
<meta property="og:description" content="This is a high-level &quot;fetch&quot; method to facilitate spatial queries to Soil Data Access (SDA) based on mukey or nationalmusym.
A SDA spatial query is made returning geometry and key identifying information about the mapunit. Additional columns from the mapunit table can be included using add.fields argument.
This function automatically &quot;chunks&quot; the input vector (using soilDB::makeChunks) of mapunit identifiers to minimize the likelihood of exceeding the SDA data request size. The number of chunks varies with the chunk.size setting and the length of your input vector. If you are working with many mapunits and/or large extents, you may need to decrease this number in order to have more chunks.
The &quot;sweet-spot&quot; chunk.size should optimize number of queries relative to the typical amount of information in each query. There is a 100,000 record limit per query and the type / complexity of the geometry affects the total result size; there is a ~32Mb JSON serialization limit.
Querying regions with complex mapping may require smaller chunk.size. Numerically adjacent IDs in the input vector may share common qualities (say, all from same soil survey area or region) which could cause specific chunks to perform &quot;poorly&quot; [slow or error] no matter what the chunk size is. Shuffling the order of the inputs using sample may help to eliminate problems related to this, depending on how you obtained your set of MUKEY/nationalmusym to query. One could feasibly use muacres as a heuristic to adjust for total acreage within chunks." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilDB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ncss-tech/soilDB/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Query SDA and Return Spatial Data</h1>
    <small class="dont-index">Source: <a href='https://github.com/ncss-tech/soilDB/blob/master/R/fetchSDA_spatial.R'><code>R/fetchSDA_spatial.R</code></a></small>
    <div class="hidden name"><code>fetchSDA_spatial.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a high-level "fetch" method to facilitate spatial queries to Soil Data Access (SDA) based on <code>mukey</code> or <code>nationalmusym</code>.</p>
<p>A SDA spatial query is made returning geometry and key identifying information about the mapunit. Additional columns from the mapunit table can be included using <code>add.fields</code> argument.</p>
<p>This function automatically "chunks" the input vector (using <code><a href='makeChunks.html'>soilDB::makeChunks</a></code>) of mapunit identifiers to minimize the likelihood of exceeding the SDA data request size. The number of chunks varies with the <code>chunk.size</code> setting and the length of your input vector. If you are working with many mapunits and/or large extents, you may need to decrease this number in order to have more chunks.</p>
<p>The "sweet-spot" <code>chunk.size</code> should optimize number of queries relative to the typical amount of information in each query. There is a 100,000 record limit per query and the type / complexity of the geometry affects the total result size; there is a ~32Mb JSON serialization limit.</p>
<p>Querying regions with complex mapping may require smaller <code>chunk.size</code>. Numerically adjacent IDs in the input vector may share common qualities (say, all from same soil survey area or region) which could cause specific chunks to perform "poorly" [slow or error] no matter what the chunk size is. Shuffling the order of the inputs using <code>sample</code> may help to eliminate problems related to this, depending on how you obtained your set of MUKEY/nationalmusym to query. One could feasibly use <code>muacres</code> as a heuristic to adjust for total acreage within chunks.</p>
    </div>

    <pre class="usage"><span class='fu'>fetchSDA_spatial</span>(
  <span class='kw'>x</span>,
  by.col = <span class='st'>"mukey"</span>,
  method = <span class='st'>"feature"</span>,
  add.fields = <span class='kw'>NULL</span>,
  chunk.size = <span class='fl'>10</span>,
  verbose = <span class='fl'>TRUE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A vector of MUKEYs or national mapunit symbols.</p></td>
    </tr>
    <tr>
      <th>by.col</th>
      <td><p>Column name containing mapunit identifier ("mukey" or "nmusym"); default: "mukey"</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>geometry result type: 'feature' returns polygons, 'bbox' returns the bounding box of each polygon, and 'point' returns a single point within each polygon.</p></td>
    </tr>
    <tr>
      <th>add.fields</th>
      <td><p>Column names from `mapunit` table to add to result. Must specify table name prefix `mapunit` before column name (e.g. `mapunit.muname`).</p></td>
    </tr>
    <tr>
      <th>chunk.size</th>
      <td><p>How many queries should spatial request be divided into? Necessary for large results. Default: 10</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Print messages?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A Spatial*DataFrame corresponding to SDA spatial data for all MUKEYs / nmusyms requested. Default result contains mapunit delineation geometry with attribute table containing `gid`, `mukey` and `nationalmusym`, plus additional fields in result specified with `add.fields`.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Andrew G. Brown</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span>(<span class='st'>"curl"</span>) <span class='op'>&amp;</span>
   <span class='kw'>curl</span>::<span class='fu'><a href='https://jeroen.cran.dev/curl/reference/nslookup.html'>has_internet</a></span>()) {

   <span class='co'># get spatial data for a single mukey</span>
    <span class='kw'>single.mukey</span> <span class='op'>&lt;-</span> <span class='fu'>fetchSDA_spatial</span>(x = <span class='st'>"2924882"</span>)
    
    <span class='co'># demonstrate fetching full extent (multi-mukey) of national musym</span>
    <span class='kw'>full.extent.nmusym</span> <span class='op'>&lt;-</span> <span class='fu'>fetchSDA_spatial</span>(x = <span class='st'>"2x8l5"</span>, by = <span class='st'>"nmusym"</span>)
    
    <span class='co'># compare extent of nmusym to single mukey within it</span>
    <span class='co'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='kw'><a href='https://github.com/edzer/sp'>sp</a></span>)) {
     <span class='fu'><a href='https://rdrr.io/pkg/aqp/man/SoilProfileCollection-plotting-methods.html'>plot</a></span>(<span class='kw'>full.extent.nmusym</span>, col = <span class='st'>"RED"</span>,border=<span class='fl'>0</span>)
     <span class='fu'><a href='https://rdrr.io/pkg/aqp/man/SoilProfileCollection-plotting-methods.html'>plot</a></span>(<span class='kw'>single.mukey</span>, add = <span class='fl'>TRUE</span>, col = <span class='st'>"BLUE"</span>, border=<span class='fl'>0</span>)
    }
    
    <span class='co'># demo adding a field (`muname`) to attribute table of result</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>fetchSDA_spatial</span>(x = <span class='st'>"2x8l5"</span>, by=<span class='st'>"nmusym"</span>, add.fields=<span class='st'>"muname"</span>))
}
</div><div class='output co'>#&gt; <span class='message'>Using 1 chunks...</span></div><div class='output co'>#&gt; <span class='message'>Chunk #1 completed (n_mukey = 1; 0.4 secs)</span></div><div class='output co'>#&gt; <span class='message'>Done in 0.4 secs; mean/chunk: 0.4 secs; mean/mukey: 0.38 secs.</span></div><div class='output co'>#&gt; <span class='message'>Using 1 chunks...</span></div><div class='output co'>#&gt; <span class='message'>Chunk #1 completed (n_mukey = 3; 1.5 secs)</span></div><div class='output co'>#&gt; <span class='message'>Done in 1.6 secs; mean/chunk: 1.5 secs; mean/mukey: 0.54 secs.</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: sp</span></div><div class='output co'>#&gt; <span class='message'>Using 1 chunks...</span></div><div class='output co'>#&gt; <span class='message'>Chunk #1 completed (n_mukey = 3; 1.1 secs)</span></div><div class='output co'>#&gt; <span class='message'>Done in 1.4 secs; mean/chunk: 1.1 secs; mean/mukey: 0.46 secs.</span></div><div class='img'><img src='fetchSDA_spatial-1.png' alt='' width='768' height='475' /></div><div class='output co'>#&gt; class       : SpatialPolygonsDataFrame 
#&gt; features    : 6 
#&gt; extent      : -121.034, -120.9596, 38.01706, 38.24938  (xmin, xmax, ymin, ymax)
#&gt; crs         : +proj=longlat +datum=WGS84 +no_defs 
#&gt; variables   : 4
#&gt; names       : gid,  mukey, nationalmusym,                                        muname 
#&gt; min values  :   1, 462101,         2x8l5, Pentz-Bellota complex, 2 to 15 percent slopes 
#&gt; max values  :   6, 462101,         2x8l5, Pentz-Bellota complex, 2 to 15 percent slopes </div><div class='input'><span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


